{"remainingRequest":"/Users/zhangyangzuo/Downloads/BSC-lucky-draw/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/zhangyangzuo/Downloads/BSC-lucky-draw/src/components/Importphoto.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/zhangyangzuo/Downloads/BSC-lucky-draw/src/components/Importphoto.vue","mtime":1617288854000},{"path":"/Users/zhangyangzuo/Downloads/BSC-lucky-draw/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/Users/zhangyangzuo/Downloads/BSC-lucky-draw/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/zhangyangzuo/Downloads/BSC-lucky-draw/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IGRhdGFiYXNlLCBEQl9TVE9SRV9OQU1FIH0gZnJvbSAnQC9oZWxwZXIvZGInOwoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICdJbXBvcnRwaG90bycsCiAgcHJvcHM6IHsKICAgIHZpc2libGU6IEJvb2xlYW4KICB9LAogIGNvbXB1dGVkOiB7CiAgICBjb25maWc6IHsKICAgICAgZ2V0KCkgewogICAgICAgIHJldHVybiB0aGlzLiRzdG9yZS5zdGF0ZS5jb25maWc7CiAgICAgIH0KICAgIH0KICB9LAogIGRhdGEoKSB7CiAgICByZXR1cm4gewogICAgICBpZDogMCwKICAgICAgdmFsdWU6ICcnLAogICAgICBmaWxlbmFtZTogJ+eCueWHu+mAieaLqeeFp+eJhycKICAgIH07CiAgfSwKICBtZXRob2RzOiB7CiAgICBpbnB1dENoYW5nZShlKSB7CiAgICAgIGNvbnN0IGZpbGVMaXN0ID0gZS50YXJnZXQuZmlsZXM7CiAgICAgIGNvbnN0IGZvcm1EYXRhID0gbmV3IEZvcm1EYXRhKCk7CiAgICAgIGZvcm1EYXRhLmFwcGVuZCgndXBsb2FkSW1nJywgZmlsZUxpc3RbMF0pOwogICAgICBjb25zdCByZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpOwogICAgICBjb25zdCBBbGxvd0ltZ0ZpbGVTaXplID0gMTAyNCAqIDE1MDsKICAgICAgY29uc3QgZmlsZSA9IGZpbGVMaXN0WzBdOwogICAgICBpZiAoZmlsZSkgewogICAgICAgIHRoaXMuZmlsZW5hbWUgPSBmaWxlLm5hbWU7CiAgICAgICAgcmVhZGVyLnJlYWRBc0RhdGFVUkwoZmlsZSk7CiAgICAgICAgcmVhZGVyLm9ubG9hZCA9ICgpID0+IHsKICAgICAgICAgIGlmICgKICAgICAgICAgICAgQWxsb3dJbWdGaWxlU2l6ZSAhPSAwICYmCiAgICAgICAgICAgIEFsbG93SW1nRmlsZVNpemUgPCByZWFkZXIucmVzdWx0Lmxlbmd0aAogICAgICAgICAgKSB7CiAgICAgICAgICAgIHJldHVybiB0aGlzLiRtZXNzYWdlLmVycm9yKCfkuI3lhYHorrjkuIrkvKDlpKfkuo4xNTBLQueahOWbvueJhycpOwogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy52YWx1ZSA9IHJlYWRlci5yZXN1bHQ7CiAgICAgICAgICB9CiAgICAgICAgfTsKICAgICAgfQogICAgfSwKICAgIGFzeW5jIHNhdmVIYW5kbGVyKCkgewogICAgICBjb25zdCB7IGlkLCB2YWx1ZSB9ID0gdGhpczsKICAgICAgY29uc3QgSUQgPSBOdW1iZXIoaWQpOwogICAgICBpZiAoIUlEIHx8IElEIDw9IDApIHsKICAgICAgICByZXR1cm4gdGhpcy4kbWVzc2FnZS5lcnJvcign5Y+356CB5b+F6aG75aSn5LqOMOeahOaVtOaVsCcpOwogICAgICB9CiAgICAgIGlmICghdmFsdWUpIHsKICAgICAgICByZXR1cm4gdGhpcy4kbWVzc2FnZS5lcnJvcign6K+36YCJ5oup54Wn54mHJyk7CiAgICAgIH0KICAgICAgY29uc3QgRGF0YSA9IGF3YWl0IGRhdGFiYXNlLmdldChEQl9TVE9SRV9OQU1FLCBJRCk7CiAgICAgIGNvbnN0IHBhcmFtID0gewogICAgICAgIGlkOiBJRCwKICAgICAgICB2YWx1ZQogICAgICB9OwogICAgICBkYXRhYmFzZVtEYXRhID8gJ2VkaXQnIDogJ2FkZCddKAogICAgICAgIERCX1NUT1JFX05BTUUsCiAgICAgICAgRGF0YSA/IElEIDogcGFyYW0sCiAgICAgICAgRGF0YSA/IHBhcmFtIDogbnVsbAogICAgICApCiAgICAgICAgLnRoZW4ocmVzID0+IHsKICAgICAgICAgIGlmIChyZXMpIHsKICAgICAgICAgICAgdGhpcy4kcmVmcy51cGxvYWRpbnB1dC52YWx1ZSA9ICcnOwogICAgICAgICAgICB0aGlzLnZhbHVlID0gJyc7CiAgICAgICAgICAgIHRoaXMuZmlsZW5hbWUgPSAn54K55Ye76YCJ5oup54Wn54mHJzsKICAgICAgICAgICAgdGhpcy4kZW1pdCgndXBkYXRlOnZpc2libGUnLCBmYWxzZSk7CiAgICAgICAgICAgIHRoaXMuJGVtaXQoJ2dldFBob3RvJyk7CiAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2UoewogICAgICAgICAgICAgIG1lc3NhZ2U6ICfkv53lrZjmiJDlip8nLAogICAgICAgICAgICAgIHR5cGU6ICdzdWNjZXNzJwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHRoaXMuJG1lc3NhZ2UuZXJyb3IoJ+S/neWtmOWksei0pScpOwogICAgICAgICAgfQogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKGVyciA9PiB7CiAgICAgICAgICB0aGlzLiRtZXNzYWdlLmVycm9yKGVyci5tZXNzYWdlKTsKICAgICAgICB9KTsKICAgIH0KICB9Cn07Cg=="},{"version":3,"sources":["Importphoto.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkDA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Importphoto.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <el-dialog\n    :visible=\"visible\"\n    :append-to-body=\"true\"\n    width=\"300px\"\n    @close=\"$emit('update:visible', false)\"\n    class=\"c-Importphoto\"\n  >\n    <el-row>\n      <label for=\"idinput\">抽奖号码</label>\n      <el-input\n        id=\"idinput\"\n        size=\"mini\"\n        type=\"number\"\n        v-model=\"id\"\n        :min=\"0\"\n        :max=\"config.number\"\n      ></el-input>\n    </el-row>\n    <el-row>\n      <label for=\"idinput\">照片选择</label>\n      <span class=\"selectbg\" :data-tip=\"filename\">\n        <input\n          ref=\"uploadinput\"\n          class=\"upload\"\n          type=\"file\"\n          accept=\".jpg,.png\"\n          @change=\"inputChange\"\n        />\n      </span>\n    </el-row>\n    <el-row class=\"photo\">\n      <label>已选照片</label>\n      <img v-if=\"value\" :src=\"value\" alt=\"img\" :width=\"140\" :height=\"140\" />\n      <span v-else>暂未选择</span>\n    </el-row>\n    <el-row>\n      支持jpg和png，照片大小不能超过150kb,建议20-50kb，建议尺寸为160*160px\n    </el-row>\n    <el-row class=\"center\">\n      <el-button size=\"mini\" type=\"primary\" @click=\"saveHandler\"\n        >保存</el-button\n      >\n      <el-button size=\"mini\" @click=\"$emit('update:visible', false)\"\n        >取消</el-button\n      >\n    </el-row>\n  </el-dialog>\n</template>\n<script>\nimport { database, DB_STORE_NAME } from '@/helper/db';\n\nexport default {\n  name: 'Importphoto',\n  props: {\n    visible: Boolean\n  },\n  computed: {\n    config: {\n      get() {\n        return this.$store.state.config;\n      }\n    }\n  },\n  data() {\n    return {\n      id: 0,\n      value: '',\n      filename: '点击选择照片'\n    };\n  },\n  methods: {\n    inputChange(e) {\n      const fileList = e.target.files;\n      const formData = new FormData();\n      formData.append('uploadImg', fileList[0]);\n      const reader = new FileReader();\n      const AllowImgFileSize = 1024 * 150;\n      const file = fileList[0];\n      if (file) {\n        this.filename = file.name;\n        reader.readAsDataURL(file);\n        reader.onload = () => {\n          if (\n            AllowImgFileSize != 0 &&\n            AllowImgFileSize < reader.result.length\n          ) {\n            return this.$message.error('不允许上传大于150KB的图片');\n          } else {\n            this.value = reader.result;\n          }\n        };\n      }\n    },\n    async saveHandler() {\n      const { id, value } = this;\n      const ID = Number(id);\n      if (!ID || ID <= 0) {\n        return this.$message.error('号码必须大于0的整数');\n      }\n      if (!value) {\n        return this.$message.error('请选择照片');\n      }\n      const Data = await database.get(DB_STORE_NAME, ID);\n      const param = {\n        id: ID,\n        value\n      };\n      database[Data ? 'edit' : 'add'](\n        DB_STORE_NAME,\n        Data ? ID : param,\n        Data ? param : null\n      )\n        .then(res => {\n          if (res) {\n            this.$refs.uploadinput.value = '';\n            this.value = '';\n            this.filename = '点击选择照片';\n            this.$emit('update:visible', false);\n            this.$emit('getPhoto');\n            this.$message({\n              message: '保存成功',\n              type: 'success'\n            });\n          } else {\n            this.$message.error('保存失败');\n          }\n        })\n        .catch(err => {\n          this.$message.error(err.message);\n        });\n    }\n  }\n};\n</script>\n<style lang=\"scss\">\n.c-Importphoto {\n  .el-dialog {\n    height: 380px;\n  }\n  label {\n    margin-right: 20px;\n    vertical-align: top;\n  }\n  .el-input {\n    width: 140px;\n  }\n  .el-row {\n    padding: 5px 0;\n  }\n  .center {\n    text-align: center;\n  }\n  .selectbg {\n    display: inline-block;\n    border: 1px solid #ccc;\n    border-radius: 2px;\n    width: 140px;\n    height: 28px;\n    position: relative;\n    box-sizing: border-box;\n    &::before {\n      content: attr(data-tip);\n      width: 100%;\n      height: 100%;\n      text-align: center;\n      position: absolute;\n      top: 0;\n      left: 0;\n      line-height: 28px;\n      cursor: pointer;\n      overflow: hidden;\n      font-size: 12px;\n    }\n    .upload {\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      opacity: 0;\n      z-index: 10;\n      cursor: pointer;\n    }\n  }\n  .photo {\n    img {\n      border: 1px solid #ccc;\n    }\n    span {\n      display: inline-block;\n      border: 1px solid #ccc;\n      border-radius: 2px;\n      width: 140px;\n      height: 140px;\n      line-height: 140px;\n      text-align: center;\n      position: relative;\n      box-sizing: border-box;\n    }\n  }\n}\n</style>\n"]}]}